# 🚀 Cockpit Ecosystem Design Specification (仕様書)

## 1. 開発哲学 (Philosophy)

* **Zero Cognitive Load:** ユーザーは「何がしたいか (Intent)」だけを表明し、「どう実装するか (Implementation)」はシステムが自動で担う。
* **Immutability (不変性):** Nix Flakes により、環境構築は「宣言的」である。システムは常にクリーンな状態を保ち、環境構築はどこでも再現可能であること。

## 2. システムの所有権ポリシー (File Ownership Policy)

手動によるファイル破損とNixの衝突エラーを避けるため、以下のルールを厳守する。

| ファイル/ディレクトリ | 所有者 | 目的 | 編集ルール |
| :--- | :--- | :--- | :--- |
| `~/.zshrc` | Nix (Home Manager) | 環境の読み込み。 | **閲覧のみ可。編集禁止。** 変更は必ず `zsh.nix` を経由する。 |
| `~/dotfiles/zsh/functions/` | ユーザー | Zshの関数、エイリアス、ロジック。 | **シェルロジックは全てここに記述する。** |
| `~/dotfiles/nix/modules/*` | Nix | 外部ツール設定。 | **手動設定禁止。** 常に `nix/modules/` で設定する。 |

## 3. 運用ルール (Operational Rules)

1.  **環境更新:** 設定変更後は必ず `nix-up` を実行する。
2.  **Git:** 変更を適用する際には、システムが自動で `gcm` を実行し、Git履歴をクリーンに保つ。
3.  **コスト管理:** 外部APIの使用コストは、ローカルの `~/.cache/cockpit_api_usage.log` で管理される。

## 4. トレードオフ提示プロトコル

新しい機能の提案時は、必ず以下の情報を提示する。

* **メリット/デメリット表:** 機能と、それによって生じる認知負荷・セキュリティリスクのトレードオフを明確化する。
* **最終決定権:** 常にユーザーに最終的なGo/No-Goの判断を委ねる。
